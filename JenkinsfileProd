node {
    properties(
        [
            pipelineTriggers([pollSCM('H/2 * * * *')]),
            disableConcurrentBuilds()
        ]
    )

    stage('Clone repository'){
        checkout scm
    }

    stage('Build and Upload App Bundle to Play Store'){
        withCredentials([
            [$class: "FileBinding", credentialsId: 'play-store-svc-acc', variable: 'PLAY_STORE_SVC_ACC'],
        ]){
            sh "cp appsettings.json appsettings.local.json && sudo chmod 755 appsettings.local.json"
            sh "cp ${PLAY_STORE_SVC_ACC} play-store-service-account.json && sudo chmod 755 play-store-service-account.json"
            app = docker.build("flutter:demo", "-f DockerfileProd .")
        }

        echo "App Bundle uploaded to Play Store"
    }

    stage('Completed'){
        echo "Completed"
    }
}